<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expert Council Web App</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #chat { width: 100%; height: 300px; }
        #input { width: 100%; }
    </style>
</head>
<body>
    <h1>Expert Council Web App</h1>
    <label for="apiKey">API Key:</label>
    <input type="text" id="apiKey" placeholder="Enter your API key">
    <button onclick="startChat()">Start Chat</button>
    <div id="chat"></div>
    <input type="text" id="input" placeholder="Type your message here" onkeydown="if(event.key === 'Enter') sendMessage()">
    <script>
        let experts = [];
        let history = [];
        let apiKey = '';

        function startChat() {
            apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                alert('Please enter an API key.');
                return;
            }
            document.getElementById('chat').innerHTML = '<p>Welcome to the Expert Council Simulation!</p>';
        }

        window.onload = function() {
            apiKey = prompt("Please enter your API key:");
            if (!apiKey) {
                alert('API key is required to use this application.');
            }
        };
        let experts = [];
        let history = [];
        let apiKey = '';

        function startChat() {
            apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                alert('Please enter an API key.');
                return;
            }
            document.getElementById('chat').innerHTML = '<p>Welcome to the Expert Council Simulation!</p>';
        }

        function sendMessage() {
            const message = document.getElementById('input').value;
            if (!message) return;
            document.getElementById('chat').innerHTML += `<p>You: ${message}</p>`;
            history.push({ "Live Person": message });
            document.getElementById('input').value = '';
            promptExpertResponse();
        }

        function promptExpertResponse() {
            const choice = prompt("Who should reply? Options: A (All), N (None), or expert number.");
            if (choice === "A") {
                experts.forEach(expert => expertReply(expert));
            } else if (choice !== "N") {
                const expertIdx = parseInt(choice);
                if (!isNaN(expertIdx) && expertIdx >= 0 && expertIdx < experts.length) {
                    expertReply(experts[expertIdx]);
                } else {
                    alert("Invalid choice. Please try again.");
                }
            }
        }

        function expertReply(expert) {
            const expertDescriptions = experts.filter(exp => exp !== expert)
                .map(exp => `${exp.name}: Expertise in ${exp.expertise}, Personality: ${exp.personality}`)
                .join("\n");

            const prompt = `
                You are ${expert.name}, an expert in ${expert.expertise} with a ${expert.personality} personality. 
                Here are the other experts:\n${expertDescriptions}. \n\n 
                Keep it conversational. Don't jump to conclusions and don't start with solutions. Minimize bullet points.
                Do not answer for other experts. Only answer for yourself.
                Don't focus on the points already made.
                Focus on your unique strengths and experiences, don't try to give generic, well-rounded advice
            `;

            const expertDescriptions = experts.filter(exp => exp !== expert)
                .map(exp => `${exp.name}: Expertise in ${exp.expertise}, Personality: ${exp.personality}`)
                .join("\n");

            const prompt = `
                You are ${expert.name}, an expert in ${expert.expertise} with a ${expert.personality} personality. 
                Here are the other experts:\n${expertDescriptions}. \n\n 
                Keep it conversational. Don't jump to conclusions and don't start with solutions. Minimize bullet points.
                Do not answer for other experts. Only answer for yourself.
                Don't focus on the points already made.
                Focus on your unique strengths and experiences, don't try to give generic, well-rounded advice
            `;

            fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4o',
                    messages: [{ role: 'user', content: prompt }]
                })
            })
            .then(response => response.json())
            .then(data => {
                const responseText = data.choices[0].message.content.trim();
                document.getElementById('chat').innerHTML += `<p>${expert.name}: ${responseText}</p>`;
                history.push({ [expert.name]: responseText });
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('chat').innerHTML += `<p>Error: Unable to fetch response from API.</p>`;
            });
        }
    </script>
</body>
</html>
